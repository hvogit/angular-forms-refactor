<!DOCTYPE html>
<html ng-app="MyApp">
<head>
<title>My Angular App</title>
<style>
  .cell {
    width:100px;
    height:100px;
    border:1px solid red;
    display:inline-block;
  }
  .row {
    display:block;
  }

.i-0 { color:red; }
.i-1 { color:blue; }
.i-2 { color:yellow; }
.i-3 { color:orange; }
.i-4 { color:pink; }
.i-5 { color:black; }
.i-6 { color:teal; }
</style>
</head>
<body>

<grid color-grid data="data">

</grid>

 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="https://code.angularjs.org/1.3.4/angular.js"></script>
<script type="text/javascript">
angular.module("MyApp", [])
  .directive("grid", [function() {
    return {
      templateUrl : './grid-template.html',
      controller : ['$attrs', '$scope', function($attrs, $scope) {
        $scope.rows = $scope.$eval($attrs.data);
      }]
    };
  }])

  .directive("colorGrid", [function() {
    return function(scope, element) {
      scope.$evalAsync(function() {
        scope.$evalAsync(function() {
          var cells = element.find('.cell');
          var map = new Map();
          for(var i=0;i<cells.length;i++) {
            var cell = cells[i];
            map.set(cell, 0);
          }

          console.log(cells.length);
          cells.hover(function() {
            var cell = $(this);
            var node = cell[0];
            var count = map.get(cell) || 0;
            count++;
            map.set(cell, count);
            console.log(node);
            node.className = 'cell i-' + count;
          });
        });
      });
    }
  }])
  
  .run(["$rootScope", function($rootScope) {
    $rootScope.data = [
      [1,2,3,4,5],
      [1,2,3,4,5],
      [1,2,3,4,5],
      [1,2,3,4,5]
    ];
  }])
  
</script>
</body>
</html>
